{{template "header.html" .}}
<title>标签管理</title>

<style>
.diff{white-space:initial;line-height:1.5em;margin:0.2em 0}
.hl, .hltag{border-bottom: solid 2px #233;display:inline-block;padding:0.1em 0.5em;}
.hltag span{ margin: 0 0.5em}
</style>

<div style='display:flex;align-items:center'>
    <div class='tag-box button' style='margin-right:1em'><a href='?id=0&desc=1'>全局</a></div>
    <div class='tag-box button {{if (not .T.desc)}}selected{{end}}'><a href='?id={{.T.tag.Id}}'>最旧</a></div>
    <div class='tag-box button {{if (.T.desc)}}selected{{end}}'><a href='?desc=1&id={{.T.tag.Id}}'>最新</a></div>
</div>

<div>
    <table id=list>
        <tr>
            <td colspan=2>
                <div class=display >
                    <span>
                        {{if .T.tag.Valid}}<b>{{.T.tag.Name}}</b>{{else}}全局{{end}}
                        操作记录
                    </span>
                </div>
            </td>
        </tr>
        {{range .T.records}}
        <tr id='record{{.Id}}'>
            <td class='small'>
                <div style='padding:0.2em'>
                <div>{{.Action}}</div>
                <div>{{.Modifier}}</div>
                <div>{{formatUnixMilli .CreateUnix}}</div>
                </div>
            </td>
            <td>
                {{if not .Diffs}}
                    <div class=>NA</div>
                {{else}}
                    {{$tagid := .TagId}}
                    {{range .Diffs}}
                    <div class=diff>
                        {{$el := (index . 0)}}
                        {{$old := index . 1}}
                        {{$new := index . 2}}
                        {{if not $.T.tag.Valid}}<a href='/tag/manage?edittagid={{$tagid}}'>#{{$tagid}}</a>{{end}}
                        {{if eq $el "parents"}}
                            父标签由
                            <div class='hltag'>{{if not $old}}<b>空</b>{{else}}{{range $old}}<span>{{.Name}}</span>{{end}}{{end}}</div>
                            变为 
                            <div class='hltag'>{{if not $new}}<b>空</b>{{else}}{{range $new}}<span>{{.Name}}</span>{{end}}{{end}}</div>
                        {{else}}
                            {{if eq $el "lock"}}
                            {{if $new}}锁定{{else}}解锁{{end}}
                            {{else}}
                            {{if eq $el "name"}}标签名由{{end}}
                            {{if eq $el "reviewname"}}审核标签名由{{end}}
                            {{if eq $el "desc"}}描述由{{end}}
                            {{if eq $el "reviewdesc"}}审核描述由{{end}}
                            <div class=hl>{{if not $old}}<b>空</b>{{else}}{{$old}}{{end}}</div>
                            变为
                            <div class=hl>{{if not $new}}<b>空</b>{{else}}{{$new}}{{end}}</div>
                            {{end}}
                        {{end}}
                    </div>
                    {{end}}
                {{end}}
            </td>
        </tr>
        {{end}}
    </table>
</div>

<div id=page style='text-align:center'>
    {{range (generatePages .T.page .T.pages)}}
        {{if eq . 0}}
        <span>...</span>
        {{else}}
        <div class='tag-box nav-page button {{if eq . $.T.page}}selected{{end}}'>
            {{if eq . $.T.page}}
            <span><b>{{.}}</b></span>
            {{else}}
            <a href='?p={{.}}&desc={{if $.T.desc}}1{{end}}'>{{.}}</a>
            {{end}}
        </div>
        {{end}}
    {{end}}
</div>
{{template "footer.html" .}}
